<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>TG Button WebUI</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/drawflow.min.css">
</head>
<body>
  <header>
    <h1>Telegram 按钮管理 WebUI</h1>
    <p class="muted">在一个统一的界面中，通过可视化布局、弹窗编辑来管理您的按钮、菜单和动作。</p>
  </header>
  <main>
    <div class="toolbar">
      <button id="refreshBtn">刷新</button>
      <button id="saveBtn">保存全部</button>
      <button id="exportBtn" class="secondary">导出 JSON</button>
          </div>

    <div class="tab-nav">
        <div id="tabIndicator"></div>
        <button class="tab-link active" data-tab="tab-layout">菜单与布局</button>
        <button class="tab-link" data-tab="tab-actions">动作 (Actions)</button>
        <button class="tab-link" data-tab="tab-webapps">WebApp</button>
        <button class="tab-link" data-tab="tab-workflow">工作流 (Workflow)</button>
    </div>

    <div id="tab-layout" class="tab-content active">
      <div class="layout-container">
        <div id="menus-column">
          <section id="menuSection">
            <h2>菜单 (Menus) <button id="addMenuBtn">新增菜单</button></h2>
            <div id="menusContainer"></div>
          </section>
        </div>
        <div id="button-bank-column">
          <section id="buttonBankSection">
            <h2>未分配的按钮</h2>
            <div id="unassignedButtonsContainer" class="menu-layout-row">
              <p class="muted">长按并拖拽到左侧菜单的行中进行分配。</p>
            </div>
            <div class="button-bank-controls">
              <button id="addUnassignedBtn">创建新按钮</button>
            </div>
          </section>
        </div>
      </div>
    </div>

    <div id="tab-actions" class="tab-content">
        <section id="actionSection">
          <h2>动作 (Actions) <button id="addActionBtn">新增动作</button></h2>
          <div id="actionsContainer"></div>
        </section>
    </div>

    <div id="tab-webapps" class="tab-content">
        <section id="webappSection">
          <h2>WebApp 管理 <button id="addWebappBtn">新增 WebApp</button></h2>
          <div id="webappsContainer"></div>
        </section>
    </div>

    <div id="tab-workflow" class="tab-content">
      <section id="workflowSection">
        <div class="workflow-section-header">
          <div class="workflow-header-bar">
            <h2>工作流编辑器</h2>
            <div class="workflow-header-actions">
              <div class="workflow-primary-actions">
                <button id="newWorkflowBtn" type="button">新建</button>
                <select id="workflowSelector" class="secondary" aria-label="选择现有工作流"></select>
                <label for="workflowNameInput" class="visually-hidden">工作流名称</label>
                <input type="text" id="workflowNameInput" placeholder="输入工作流名称" aria-label="工作流名称">
                <button id="editWorkflowDescriptionBtn" class="secondary" type="button">描述</button>
              </div>
              <div class="workflow-secondary-actions">
                <button id="saveWorkflowBtn" class="secondary" type="button">保存当前工作流</button>
                <button id="deleteWorkflowBtn" class="danger" type="button">删除</button>
              </div>
            </div>
          </div>
          <p id="workflowDescriptionPreview" class="workflow-description-preview muted" data-empty="true">尚未添加描述。</p>
        </div>
        <input type="hidden" id="workflowDescriptionInput">
        <div class="workflow-editor-body">
          <div id="node-palette" class="node-palette-container">
            <div class="node-palette-header">
              <div>
                <h4>模块化动作</h4>
                <p class="muted">从这里拖拽动作节点到右侧画布。</p>
              </div>
              <div class="node-palette-tools">
                <input type="search" id="nodePaletteSearch" placeholder="搜索动作..." aria-label="搜索模块化动作">
                <button id="uploadModularActionBtn" class="secondary compact" type="button">上传</button>
              </div>
            </div>
            <input type="file" id="nodePaletteUploadInput" accept=".py" hidden>
            <div id="nodePaletteList" class="node-palette-scroll" role="list" aria-label="可用模块化动作列表">
              <!-- 节点列表将在此处注入 -->
            </div>
          </div>
          <div class="workflow-canvas-wrapper">
            <div id="drawflow"></div>
            <div class="workflow-zoom-controls" role="group" aria-label="画布缩放">
              <button id="workflowZoomOut" class="secondary" type="button" title="缩小画布">-</button>
              <span id="workflowZoomValue" class="workflow-zoom-display">100%</span>
              <button id="workflowZoomIn" class="secondary" type="button" title="放大画布">+</button>
              <button id="workflowZoomReset" class="secondary" type="button" title="重置缩放">重置</button>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- 模态框结构 -->
  <div id="modal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h2 id="modalTitle">编辑</h2>
        <button id="modalCloseBtn" class="close-btn">&times;</button>
      </div>
      <div id="modalBody" class="modal-body">
        <!-- 模态框内容将在此处注入 -->
      </div>
      <div id="modalFooter" class="modal-footer">
        <!-- 模态框按钮将在此处注入 -->
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <script src="/static/main.js"></script>
  <script src="/static/drawflow.min.js"></script>
  <script src="/static/editor.js"></script>

</body>
</html>